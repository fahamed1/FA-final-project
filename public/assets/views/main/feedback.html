<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Feedback Form</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    </head>
    <body>

        <div class="feedback">
            <h2 class="margin-thirty">Add Feedback</h2>
            <form id="feedback-form">
            <div class="form-group margin-twenty">
                <label for="firstName" id="firstName-label">First Name</label>
                <label id="firstName-error"></label>
                <input type="text" class="form-control" id="firstName"
                       placeholder="Enter First Name">
            </div>
            <div class="form-group margin-ten">
                <label for="lastName" id="lastName-label">Last Name</label>
                <label id="lastName-error"></label>
                <input type="text" class="form-control" id="lastName"
                       placeholder="Enter Last Name">
            </div>
            <br>

            <label for="feedback">Feedback:</label> <br>
            <label id="feedback-error"></label>
            <textarea class="form-control" id="feedbackMessage" placeholder="Enter your feedback" rows="4"></textarea>
            <br>

            <button type="submit">Submit Feedback</button>
            </form>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>

            $(document).ready(function () {

                $('#feedback-form').on('submit', function (e) {
                    e.preventDefault();
                    const firstName = $('#firstName').val();
                    const lastName = $('#lastName').val();
                    var feedback = $('#feedbackMessage').val();

                    const data = {
                        firstName,
                        lastName,
                        feedback,
                    }

                    $.ajax({
                        url: `http://localhost:8888/api/feedback`,
                        type: "POST",
                        data: data,
                        dataType: "json",
                        success: function (data) {
                            console.log(data);
                            window.location.replace("/");
                        },
                        error: function (data){
                            // window.location.replace("/users-view");
                            console.log(data.responseJSON)
                            $('#firstName-error').html('')
                            $('#lastName-error').html('')
                            $('#feedback-error').html('');
                            $('#firstName').removeClass('error-border')
                            $('#lastName').removeClass('error-border')
                            $('#feedbackMessage').removeClass('error-border');
                            if (data.responseJSON?.requiredFirstName) {
                                $('#firstName').addClass('error-border')
                                $('#firstName-error').append(` <span class='error-text'>${data.responseJSON?.requiredFirstName}</span>`)
                            }
                            if (data.responseJSON?.firstNameShort) {
                                $('#firstName').addClass('error-border')
                                $('#firstName-error').append(` <span class='error-text'>${data.responseJSON?.firstNameShort}</span>`)
                            }

                            if (data.responseJSON?.requiredLastName) {
                                $('#lastName').addClass('error-border')
                                $('#lastName-error').append(` <span class='error-text'>${data.responseJSON?.requiredLastName}</span>`)
                            }
                            if (data.responseJSON?.lastNameShort) {
                                $('#lastName').addClass('error-border')
                                $('#lastName-error').append(` <span class='error-text'>${data.responseJSON?.lastNameShort}</span>`)
                            }
                            
                            if (data.responseJSON?.requiredFeedbackMessage) {
                                $('#feedbackMessage').addClass('error-border');
                                $('#feedback-error').append(`<span class='error-text'>${data.responseJSON?.requiredFeedbackMessage}</span>`);
                            }
                            if (data.responseJSON?.feedbackMessageShort) {
                                $('#feedbackMessage').addClass('error-border')
                                $('#lastName-error').append(` <span class='error-text'>${data.responseJSON?.feedbackMessageShort}</span>`)
                            }

                        }
                    });
                })

            })


        </script>

    </body>
</html>